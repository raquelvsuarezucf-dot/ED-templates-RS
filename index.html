<!DOCTYPE html>
<html lang="en" class="h-full"><head>

  <meta charset="UTF-8">

  <meta name="viewport" content="width=device-width,initial-scale=1">

  <title>EM Templates</title>

  <!-- favicon -->

  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect width='64' height='64' rx='14' ry='14' fill='%231f3850'/%3E%3Ctext x='50%' y='54%' text-anchor='middle' font-size='30' fill='white' font-family='system-ui,Segoe UI,Helvetica,Arial,sans-serif'%3EEM%3C/text%3E%3C/svg%3E">

  <script src="https://cdn.tailwindcss.com"></script>

  <script>

    tailwind.config = {

      theme: {

        extend: {

          colors: {

            ink: '#0f2640',

            shell: '#eaf1fb',

            panel: '#ffffff',

            navy: '#1f3850',

            accent: '#1E70C1'

          },

          boxShadow: {

            card: '0 10px 28px rgba(15,38,64,.08)'

          },

          borderRadius: {

            '2xl': '1rem'

          }

        }

      }

    }

  </script>

  <style>

    :root { color-scheme: light; }

    body {

      background: #eaf1fb;

      font-size: 15px;

    }

    .macro-card { background: #1f3850; }

    .macro-body {

      background: #e5e7eb;

      white-space: pre-wrap;

      font-size: 0.9rem;

      line-height: 1.6;

    }

    .settings-pop { display: none; }

    .settings-pop.open { display: block; }

    #edit-modal, #new-macro-modal, #login-overlay { display: none; }

    #edit-modal.open, #new-macro-modal.open, #login-overlay.open { display: flex; }

    .cat-btn.drag-target { outline: 2px dashed #1E70C1; outline-offset: 2px; }

    @media (max-width: 768px) {

      #edit-modal > div { height: 90vh; }

    }

  </style>

<style>*, ::before, ::after{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/* ! tailwindcss v3.4.17 | MIT License | https://tailwindcss.com */*,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::after,::before{--tw-content:''}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.pointer-events-none{pointer-events:none}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.inset-0{inset:0px}.bottom-4{bottom:1rem}.left-1\/2{left:50%}.left-3\.5{left:0.875rem}.right-4{right:1rem}.top-16{top:4rem}.top-2\.5{top:0.625rem}.z-50{z-index:50}.z-\[999\]{z-index:999}.mb-1{margin-bottom:0.25rem}.mb-3{margin-bottom:0.75rem}.mt-1{margin-top:0.25rem}.mt-5{margin-top:1.25rem}.block{display:block}.flex{display:flex}.inline-flex{display:inline-flex}.grid{display:grid}.hidden{display:none}.h-10{height:2.5rem}.h-\[80vh\]{height:80vh}.h-full{height:100%}.max-h-\[90vh\]{max-height:90vh}.min-h-0{min-height:0px}.min-h-\[160px\]{min-height:160px}.min-h-screen{min-height:100vh}.w-10{width:2.5rem}.w-\[250px\]{width:250px}.w-\[340px\]{width:340px}.w-\[min\(360px\2c 100\%\)\]{width:min(360px,100%)}.w-\[min\(680px\2c 100\%\)\]{width:min(680px,100%)}.w-\[min\(980px\2c 100\%\)\]{width:min(980px,100%)}.w-full{width:100%}.min-w-0{min-width:0px}.max-w-\[540px\]{max-width:540px}.flex-1{flex:1 1 0%}.shrink-0{flex-shrink:0}.-translate-x-1\/2{--tw-translate-x:-50%;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.resize-none{resize:none}.grid-cols-2{grid-template-columns:repeat(2, minmax(0, 1fr))}.flex-col{flex-direction:column}.items-start{align-items:flex-start}.items-center{align-items:center}.justify-end{justify-content:flex-end}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-2{gap:0.5rem}.gap-3{gap:0.75rem}.gap-1{gap:0.25rem}.space-y-2 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(0.5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(0.5rem * var(--tw-space-y-reverse))}.space-y-3 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(0.75rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(0.75rem * var(--tw-space-y-reverse))}.space-y-4 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(1rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1rem * var(--tw-space-y-reverse))}.overflow-auto{overflow:auto}.overflow-hidden{overflow:hidden}.rounded-2xl{border-radius:1rem}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:0.5rem}.rounded-md{border-radius:0.375rem}.rounded-b-2xl{border-bottom-right-radius:1rem;border-bottom-left-radius:1rem}.border{border-width:1px}.border-b{border-bottom-width:1px}.border-r{border-right-width:1px}.border-t{border-top-width:1px}.border-slate-200{--tw-border-opacity:1;border-color:rgb(226 232 240 / var(--tw-border-opacity, 1))}.border-slate-200\/70{border-color:rgb(226 232 240 / 0.7)}.bg-accent{--tw-bg-opacity:1;background-color:rgb(30 112 193 / var(--tw-bg-opacity, 1))}.bg-black\/30{background-color:rgb(0 0 0 / 0.3)}.bg-ink{--tw-bg-opacity:1;background-color:rgb(15 38 64 / var(--tw-bg-opacity, 1))}.bg-shell{--tw-bg-opacity:1;background-color:rgb(234 241 251 / var(--tw-bg-opacity, 1))}.bg-slate-100{--tw-bg-opacity:1;background-color:rgb(241 245 249 / var(--tw-bg-opacity, 1))}.bg-slate-900\/70{background-color:rgb(15 23 42 / 0.7)}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}.bg-panel{--tw-bg-opacity:1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}.bg-white\/10{background-color:rgb(255 255 255 / 0.1)}.bg-white\/70{background-color:rgb(255 255 255 / 0.7)}.p-2{padding:0.5rem}.p-3{padding:0.75rem}.p-4{padding:1rem}.p-5{padding:1.25rem}.p-3\.5{padding:0.875rem}.px-2{padding-left:0.5rem;padding-right:0.5rem}.px-3\.5{padding-left:0.875rem;padding-right:0.875rem}.px-4{padding-left:1rem;padding-right:1rem}.px-5{padding-left:1.25rem;padding-right:1.25rem}.py-1{padding-top:0.25rem;padding-bottom:0.25rem}.py-1\.5{padding-top:0.375rem;padding-bottom:0.375rem}.py-2{padding-top:0.5rem;padding-bottom:0.5rem}.py-2\.5{padding-top:0.625rem;padding-bottom:0.625rem}.py-3{padding-top:0.75rem;padding-bottom:0.75rem}.py-4{padding-top:1rem;padding-bottom:1rem}.py-5{padding-top:1.25rem;padding-bottom:1.25rem}.px-2\.5{padding-left:0.625rem;padding-right:0.625rem}.py-0\.5{padding-top:0.125rem;padding-bottom:0.125rem}.pl-10{padding-left:2.5rem}.pr-4{padding-right:1rem}.pt-1{padding-top:0.25rem}.text-\[0\.95rem\]{font-size:0.95rem}.text-\[1\.05rem\]{font-size:1.05rem}.text-\[10px\]{font-size:10px}.text-\[11px\]{font-size:11px}.text-\[1rem\]{font-size:1rem}.text-base{font-size:1rem;line-height:1.5rem}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:0.875rem;line-height:1.25rem}.text-xs{font-size:0.75rem;line-height:1rem}.text-\[0\.9rem\]{font-size:0.9rem}.font-semibold{font-weight:600}.leading-5{line-height:1.25rem}.leading-tight{line-height:1.25}.leading-6{line-height:1.5rem}.text-accent{--tw-text-opacity:1;color:rgb(30 112 193 / var(--tw-text-opacity, 1))}.text-ink{--tw-text-opacity:1;color:rgb(15 38 64 / var(--tw-text-opacity, 1))}.text-red-500{--tw-text-opacity:1;color:rgb(239 68 68 / var(--tw-text-opacity, 1))}.text-slate-400{--tw-text-opacity:1;color:rgb(148 163 184 / var(--tw-text-opacity, 1))}.text-slate-500{--tw-text-opacity:1;color:rgb(100 116 139 / var(--tw-text-opacity, 1))}.text-slate-600{--tw-text-opacity:1;color:rgb(71 85 105 / var(--tw-text-opacity, 1))}.text-slate-700{--tw-text-opacity:1;color:rgb(51 65 85 / var(--tw-text-opacity, 1))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.opacity-0{opacity:0}.opacity-100{opacity:1}.shadow-card{--tw-shadow:0 10px 28px rgba(15,38,64,.08);--tw-shadow-colored:0 10px 28px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.transition{transition-property:color, background-color, border-color, fill, stroke, opacity, box-shadow, transform, filter, -webkit-text-decoration-color, -webkit-backdrop-filter;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter, -webkit-text-decoration-color, -webkit-backdrop-filter;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.hover\:bg-accent\/90:hover{background-color:rgb(30 112 193 / 0.9)}.hover\:bg-slate-200:hover{--tw-bg-opacity:1;background-color:rgb(226 232 240 / var(--tw-bg-opacity, 1))}.hover\:bg-slate-50:hover{--tw-bg-opacity:1;background-color:rgb(248 250 252 / var(--tw-bg-opacity, 1))}.hover\:bg-white:hover{--tw-bg-opacity:1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}.hover\:bg-white\/20:hover{background-color:rgb(255 255 255 / 0.2)}.hover\:text-ink:hover{--tw-text-opacity:1;color:rgb(15 38 64 / var(--tw-text-opacity, 1))}.hover\:underline:hover{-webkit-text-decoration-line:underline;text-decoration-line:underline}.focus\:outline-none:focus{outline:2px solid transparent;outline-offset:2px}.focus\:ring-2:focus{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000)}.focus\:ring-accent\/50:focus{--tw-ring-color:rgb(30 112 193 / 0.5)}</style></head>

<body class="h-full min-h-screen flex flex-col">

  <!-- LOGIN OVERLAY -->

  <div id="login-overlay" class="fixed inset-0 bg-slate-900/70 z-[999] items-center justify-center p-4">

    <div class="bg-white rounded-2xl w-[min(360px,100%)] shadow-card border border-slate-200">

      <div class="px-5 py-4 border-b border-slate-200">

        <h1 class="text-base font-semibold text-ink">EM Templates ‚Äî Login</h1>

        <p class="text-xs text-slate-500 mt-1">Enter the site credentials.</p>

      </div>

      <div class="p-5 space-y-3">

        <div>

          <label class="text-xs text-slate-600 block mb-1" for="login-user">Username</label>

          <input id="login-user" class="w-full border border-slate-200 rounded-lg px-2 py-1.5 text-sm" placeholder="emtemplates">

        </div>

        <div>

          <label class="text-xs text-slate-600 block mb-1" for="login-pass">Password</label>

          <input id="login-pass" type="password" class="w-full border border-slate-200 rounded-lg px-2 py-1.5 text-sm" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">

        </div>

        <p id="login-error" class="text-xs text-red-500 hidden">Incorrect username or password.</p>

        <button id="login-submit" class="w-full bg-accent text-white text-sm py-1.5 rounded-lg">Login</button>

      </div>

    </div>

  </div>

  <!-- TOP BAR -->

  <header class="w-full bg-shell border-b border-slate-200/70 px-5 py-3 flex items-center justify-between gap-3">

    <div class="flex items-center gap-3">

      <div class="w-10 h-10 rounded-full bg-ink text-white flex items-center justify-center text-sm font-semibold">EM</div>

      <div>

        <div class="text-[1rem] font-semibold text-ink leading-tight">EM Templates</div>

        <div class="text-[11px] text-slate-500 leading-tight">Local-only macros ‚Ä¢ Searchable ‚Ä¢ Dot-phrase copy ‚Ä¢ Drag &amp; drop to organize</div>

      </div>

    </div>

    <div class="flex-1 max-w-[540px]">

      <div class="relative">

        <input id="search" class="w-full bg-white border border-slate-200 rounded-full pl-10 pr-4 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-accent/50" placeholder="Search...   Tip: type .alias for live preview, Enter to copy">

        <span class="absolute left-3.5 top-2.5 text-slate-400">üîç</span>

      </div>

    </div>

    <div class="flex gap-2">

      <button id="new-macro-btn" class="px-3.5 py-1.5 rounded-full bg-white border border-slate-200 text-sm text-ink hover:bg-slate-50" type="button">+ Macro</button>

      <button id="settings-btn" class="w-10 h-10 rounded-full bg-accent hover:bg-accent/90 text-white flex items-center justify-center text-lg" type="button">‚öô</button>

    </div>

  </header>

  <!-- SETTINGS PANEL -->

  <div id="settings-pop" class="settings-pop fixed top-16 right-4 w-[340px] bg-white rounded-2xl shadow-card border border-slate-200 z-50 open">

    <div class="flex items-center justify-between px-4 py-3 border-b border-slate-200/70">

      <h2 class="text-sm font-semibold text-ink">Settings</h2>

      <button id="settings-close" class="text-xs text-slate-500 hover:text-ink">‚úï</button>

    </div>

    <div class="p-4 space-y-3">

      <p class="text-xs text-slate-500">These will be embedded into the file when you Sync ‚Äî token is obfuscated.</p>

      <div>

        <label class="text-xs text-slate-600 block mb-1" for="gh-owner">Owner</label>

        <input id="gh-owner" class="w-full border border-slate-200 rounded-lg px-2 py-1 text-sm">

      </div>

      <div class="grid grid-cols-2 gap-2">

        <div>

          <label class="text-xs text-slate-600 block mb-1" for="gh-repo">Repo</label>

          <input id="gh-repo" class="w-full border border-slate-200 rounded-lg px-2 py-1 text-sm">

        </div>

        <div>

          <label class="text-xs text-slate-600 block mb-1" for="gh-branch">Branch</label>

          <input id="gh-branch" class="w-full border border-slate-200 rounded-lg px-2 py-1 text-sm">

        </div>

      </div>

      <div>

        <label class="text-xs text-slate-600 block mb-1" for="gh-path">Path</label>

        <input id="gh-path" class="w-full border border-slate-200 rounded-lg px-2 py-1 text-sm">

      </div>

      <div>

        <label class="text-xs text-slate-600 block mb-1" for="gh-token">Personal Access Token (will sync, obfuscated)</label>

        <input id="gh-token" type="password" class="w-full border border-slate-200 rounded-lg px-2 py-1 text-sm" placeholder="ghp_...">

      </div>

      <div>

        <label class="text-xs text-slate-600 block mb-1" for="netlify-hook">Netlify build hook (optional)</label>

        <input id="netlify-hook" class="w-full border border-slate-200 rounded-lg px-2 py-1 text-sm" placeholder="https://api.netlify.com/build_hooks/...">

      </div>

      <div class="flex gap-2 pt-1">

        <button id="settings-save" class="flex-1 bg-accent text-white py-1.5 rounded-lg text-sm">Save settings</button>

        <button id="settings-sync" class="flex-1 bg-white border border-slate-200 py-1.5 rounded-lg text-sm hover:bg-slate-50">Sync</button>

      </div>

      <button id="save-site" class="w-full bg-slate-100 hover:bg-slate-200 text-xs py-1.5 rounded-lg text-slate-700">Save site (macros + categories)</button>

      <p class="text-[10px] text-slate-400">Sync = write current JSON (with obfuscated token) ‚Üí GitHub ‚Üí Netlify.</p>

    </div>

  </div>

  <!-- EDIT MODAL: title, dot, body -->

  <div id="edit-modal" class="fixed inset-0 bg-black/30 z-50 items-center justify-center p-4">

    <div class="bg-white rounded-2xl w-[min(980px,100%)] h-[80vh] flex flex-col">

      <div class="flex items-center justify-between px-4 py-3 border-b border-slate-200">

        <h2 id="edit-heading" class="text-base font-semibold text-ink">Edit ‚Äî Pediatric Streptococcal Pharyngitis (cleaned up + consistent with your tone)</h2>

        <button id="edit-close" class="text-sm text-slate-500 hover:text-ink">‚úï</button>

      </div>

      <div class="p-4 flex-1 flex flex-col gap-3 overflow-hidden">

        <div class="grid grid-cols-2 gap-3">

          <div>

            <label class="text-xs text-slate-500 block mb-1" for="edit-title">Title</label>

            <input id="edit-title" class="w-full border border-slate-200 rounded-lg px-2 py-1.5 text-sm">

          </div>

          <div>

            <label class="text-xs text-slate-500 block mb-1" for="edit-dot">Dot phrase</label>

            <input id="edit-dot" class="w-full border border-slate-200 rounded-lg px-2 py-1.5 text-sm">

          </div>

        </div>

        <div class="flex-1 flex flex-col overflow-hidden">

          <label class="text-xs text-slate-500 block mb-1" for="edit-body">Body</label>

          <textarea id="edit-body" class="flex-1 w-full border border-slate-200 rounded-lg p-3 text-sm leading-5 resize-none overflow-auto" style="min-height:0;"></textarea>

        </div>

      </div>

      <div class="p-4 flex justify-end gap-2 border-t border-slate-200">

        <button id="edit-cancel" class="px-4 py-1.5 text-sm rounded-lg border border-slate-200 bg-white">Cancel</button>

        <button id="edit-save" class="px-4 py-1.5 text-sm rounded-lg bg-accent text-white">Save</button>

      </div>

    </div>

  </div>

  <!-- NEW MACRO MODAL -->

  <div id="new-macro-modal" class="fixed inset-0 bg-black/30 z-50 items-center justify-center p-4">

    <div class="bg-white rounded-2xl w-[min(680px,100%)] max-h-[90vh] flex flex-col">

      <div class="flex items-center justify-between px-4 py-3 border-b border-slate-200">

        <h2 class="text-base font-semibold text-ink">New macro</h2>

        <button id="new-macro-close" class="text-sm text-slate-500 hover:text-ink">‚úï</button>

      </div>

      <div class="p-4 flex-1 flex flex-col gap-3 overflow-hidden">

        <div class="grid grid-cols-2 gap-3">

          <div>

            <label class="text-xs text-slate-500 block mb-1" for="new-title">Title</label>

            <input id="new-title" class="w-full border border-slate-200 rounded-lg px-2 py-1.5 text-sm">

          </div>

          <div>

            <label class="text-xs text-slate-500 block mb-1" for="new-dot">Dot phrase</label>

            <input id="new-dot" class="w-full border border-slate-200 rounded-lg px-2 py-1.5 text-sm" placeholder=".mydot">

          </div>

        </div>

        <div>

          <label class="text-xs text-slate-500 block mb-1" for="new-cat">Category</label>

          <select id="new-cat" class="w-full border border-slate-200 rounded-lg px-2 py-1.5 text-sm"></select>

        </div>

        <div class="flex-1 flex flex-col">

          <label class="text-xs text-slate-500 block mb-1" for="new-body">Body</label>

          <textarea id="new-body" class="flex-1 min-h-[160px] border border-slate-200 rounded-lg p-2 text-sm leading-5"></textarea>

        </div>

      </div>

      <div class="p-4 flex justify-end gap-2 border-t border-slate-200">

        <button id="new-macro-cancel" class="px-4 py-1.5 text-sm rounded-lg border border-slate-200 bg-white">Cancel</button>

        <button id="new-macro-save" class="px-4 py-1.5 text-sm rounded-lg bg-accent text-white">Add macro</button>

      </div>

    </div>

  </div>

  <!-- MAIN LAYOUT -->

  <div class="flex-1 flex min-h-0">

    <!-- SIDEBAR -->

    <aside class="w-[250px] shrink-0 bg-shell px-4 py-5 border-r border-slate-200/70">

      <div class="flex items-center justify-between mb-3">

        <h2 class="text-[0.95rem] font-semibold text-ink">Categories</h2>

        <button id="add-category" class="text-xs text-accent hover:underline">+ Add</button>

      </div>

      <div id="cat-list" class="space-y-2"><button type="button" data-cat="All" class="cat-btn w-full flex items-center justify-between bg-white/70 hover:bg-white rounded-2xl px-4 py-3 text-[0.9rem] text-ink bg-white"><span>All</span><span class="text-xs text-slate-500">12</span></button><button type="button" data-cat="Pediatrics" class="cat-btn w-full flex items-center justify-between bg-white/70 hover:bg-white rounded-2xl px-4 py-3 text-[0.9rem] text-ink"><span>Pediatrics</span><span class="text-xs text-slate-500">4</span></button><button type="button" data-cat="Communication" class="cat-btn w-full flex items-center justify-between bg-white/70 hover:bg-white rounded-2xl px-4 py-3 text-[0.9rem] text-ink"><span>Communication</span><span class="text-xs text-slate-500">2</span></button><button type="button" data-cat="Neonatal / Hyperbili" class="cat-btn w-full flex items-center justify-between bg-white/70 hover:bg-white rounded-2xl px-4 py-3 text-[0.9rem] text-ink"><span>Neonatal / Hyperbili</span><span class="text-xs text-slate-500">3</span></button><button type="button" data-cat="Peds ‚Äî Trauma / PECARN" class="cat-btn w-full flex items-center justify-between bg-white/70 hover:bg-white rounded-2xl px-4 py-3 text-[0.9rem] text-ink"><span>Peds ‚Äî Trauma / PECARN</span><span class="text-xs text-slate-500">3</span></button></div>

      <p class="text-[11px] text-slate-400 mt-5">Tip: drag a card into a category to move it.</p>

    </aside>

    <!-- CONTENT -->

    <main class="flex-1 min-w-0 px-4 py-5 overflow-auto">

      <div id="section-title" class="flex items-center justify-between mb-3">

        <h2 class="text-[1.05rem] font-semibold text-ink">All macros</h2>

        <span id="section-count" class="text-xs text-slate-500">12 macros</span>

      </div>

      <div id="macro-list" class="space-y-4"><div class="bg-panel rounded-2xl shadow-card" draggable="true" data-id="peds-viral">

          <div class="macro-card rounded-2xl p-3.5 flex items-start justify-between gap-3">

            <div>

              <h3 class="text-[1rem] font-semibold text-white mb-1">MDM ‚Äî Pediatric Viral / Febrile Illness</h3>

              <button data-action="copy-dot" data-id="peds-viral" class="inline-flex items-center gap-1 bg-white/10 hover:bg-white/20 text-[11px] text-white rounded-full px-2.5 py-0.5">Dot: .pedsviral</button>

            </div>

            <div class="flex gap-2 shrink-0">

              <button data-action="copy" data-id="peds-viral" class="text-xs bg-white/10 hover:bg-white/20 text-white rounded-md px-2.5 py-1">Copy</button>

              <button data-action="edit" data-id="peds-viral" class="text-xs bg-white/10 hover:bg-white/20 text-white rounded-md px-2.5 py-1">Edit</button>

              <button data-action="del" data-id="peds-viral" class="text-xs bg-white/10 hover:bg-white/20 text-white rounded-md px-2.5 py-1">Del</button>

            </div>

          </div>

          <div class="macro-body rounded-b-2xl p-3.5 text-[0.9rem] leading-6">[age]-year-old [sex] presented to the ED with [duration] of fever and associated [symptoms: cough, nasal congestion, rhinorrhea, decreased appetite, irritability]. Parent present at bedside reports patient has been tolerating PO without difficulties, with [no / mild] decrease in appetite and normal urine output. Denies vomiting, diarrhea, rash, or respiratory distress. Immunizations are up to date.<br><br>On evaluation, patient appeared well hydrated, interactive, and appropriate for age, with normal capillary refill and no increased work of breathing. Oropharynx clear, tympanic membranes without bulging or erythema, lungs clear to auscultation, and abdomen soft, non-tender, and non-distended.<br><br>Differential includes viral upper respiratory infection, early otitis media, influenza, RSV, COVID-19, and early pneumonia, though there were no focal findings to strongly suggest a bacterial source. Findings today are most consistent with a viral process. [COVID, influenza, and RSV tests were negative / pending / positive for ___ / not obtained.]<br><br>Patient remained comfortable and interactive throughout the ED visit with stable vital signs and reassuring physical findings. Findings reviewed with the parent at bedside, and supportive care discussed, including weight-based acetaminophen or ibuprofen for fever and encouraging fluids as tolerated. Parent verbalized understanding and was comfortable with the plan for discharge and outpatient follow-up.<br><br>Strict return precautions discussed, including persistent fever, respiratory distress, poor oral intake, vomiting, decreased urine output, new rash, or any new or concerning symptoms. Follow-up with pediatrician advised within 48‚Äì72 hours or sooner if symptoms worsen.</div>

        </div><div class="bg-panel rounded-2xl shadow-card" draggable="true" data-id="peds-strep">

          <div class="macro-card rounded-2xl p-3.5 flex items-start justify-between gap-3">

            <div>

              <h3 class="text-[1rem] font-semibold text-white mb-1">Pediatric Streptococcal Pharyngitis (cleaned up + consistent with your tone)</h3>

              <button data-action="copy-dot" data-id="peds-strep" class="inline-flex items-center gap-1 bg-white/10 hover:bg-white/20 text-[11px] text-white rounded-full px-2.5 py-0.5">Dot: .pedsstrep</button>

            </div>

            <div class="flex gap-2 shrink-0">

              <button data-action="copy" data-id="peds-strep" class="text-xs bg-white/10 hover:bg-white/20 text-white rounded-md px-2.5 py-1">Copy</button>

              <button data-action="edit" data-id="peds-strep" class="text-xs bg-white/10 hover:bg-white/20 text-white rounded-md px-2.5 py-1">Edit</button>

              <button data-action="del" data-id="peds-strep" class="text-xs bg-white/10 hover:bg-white/20 text-white rounded-md px-2.5 py-1">Del</button>

            </div>

          </div>

          <div class="macro-body rounded-b-2xl p-3.5 text-[0.9rem] leading-6">[age]-year-old [sex] presented to the ED with [duration] of sore throat associated with [symptoms: fever, decreased appetite, odynophagia, mild cough / no cough, nasal congestion]. Parent present at bedside reports patient has been tolerating PO intake [well / poorly] and maintaining normal urine output. Denies vomiting, drooling, neck stiffness, or respiratory distress. Immunizations are up to date.<br><br>On exam, patient appeared well hydrated, interactive, and nontoxic. Oropharyngeal exam notable for [tonsillar erythema / exudates / palatal petechiae / none], uvula midline, and no evidence of peritonsillar swelling or trismus. Cervical nodes [tender / non-tender, enlarged / not enlarged]. Lungs clear to auscultation and no meningeal signs or rash observed.<br><br>Differential includes streptococcal pharyngitis, viral pharyngitis, early tonsillitis, and mononucleosis, with low concern for peritonsillar abscess, epiglottitis, or retropharyngeal infection given the reassuring airway exam and overall well appearance. Findings today are most consistent with [streptococcal / viral] pharyngitis. [Rapid strep test positive / negative / pending; throat culture sent / not obtained.] [COVID, influenza, and RSV tests negative / positive for ___ / not obtained.]<br><br>For confirmed or suspected streptococcal infection, prescribed [amoxicillin / cephalexin / azithromycin] ‚Äî weight-based dosing ‚Äî with instructions to complete the full course. Supportive care discussed, including acetaminophen or ibuprofen for fever or throat pain, maintaining hydration, and soft foods as tolerated.<br><br>Patient remained comfortable and interactive throughout the ED visit with stable vital signs and reassuring physical findings. Findings reviewed with the parent at bedside, who verbalized understanding and was comfortable with the plan for discharge and outpatient follow-up.<br><br>Strict return precautions discussed, including persistent fever, worsening throat pain, drooling, difficulty swallowing or breathing, neck swelling, or any new or concerning symptoms. Follow-up with pediatrician advised within 48‚Äì72 hours or sooner if symptoms worsen.</div>

        </div><div class="bg-panel rounded-2xl shadow-card" draggable="true" data-id="peds-otitis">

          <div class="macro-card rounded-2xl p-3.5 flex items-start justify-between gap-3">

            <div>

              <h3 class="text-[1rem] font-semibold text-white mb-1">MDM ‚Äî Pediatric Otitis Media</h3>

              <button data-action="copy-dot" data-id="peds-otitis" class="inline-flex items-center gap-1 bg-white/10 hover:bg-white/20 text-[11px] text-white rounded-full px-2.5 py-0.5">Dot: .pedsotitis</button>

            </div>

            <div class="flex gap-2 shrink-0">

              <button data-action="copy" data-id="peds-otitis" class="text-xs bg-white/10 hover:bg-white/20 text-white rounded-md px-2.5 py-1">Copy</button>

              <button data-action="edit" data-id="peds-otitis" class="text-xs bg-white/10 hover:bg-white/20 text-white rounded-md px-2.5 py-1">Edit</button>

              <button data-action="del" data-id="peds-otitis" class="text-xs bg-white/10 hover:bg-white/20 text-white rounded-md px-2.5 py-1">Del</button>

            </div>

          </div>

          <div class="macro-body rounded-b-2xl p-3.5 text-[0.9rem] leading-6">[age]-year-old [sex] presented to the ED with [duration] of ear pain associated with [symptoms: fever, nasal congestion, cough, irritability, decreased appetite]. Parent present at bedside reports patient has been tolerating PO intake [well / poorly] with normal urinary output. Denies vomiting, drainage from the ear, rash, or respiratory distress. Immunizations are up to date.<br><br>On exam, patient appeared well hydrated and interactive for age. Right / left tympanic membrane noted to be [erythematous / bulging / dull / effusion present / normal]; no mastoid tenderness, auricular swelling, or drainage. Contralateral ear within normal limits. Lungs clear to auscultation, and oropharynx without erythema or exudate. Neck supple with full range of motion and no lymphadenopathy. Abdomen soft and non-tender.<br><br>Differential includes acute otitis media, otitis externa, eustachian tube dysfunction, and viral upper respiratory infection. Findings today are most consistent with [acute otitis media / serous otitis / viral URI with referred ear pain]. [COVID, influenza, and RSV tests negative / positive for ___ / not obtained.]<br><br>If bacterial:<br><br> Antibiotic therapy initiated with [amoxicillin / cefdinir / azithromycin], weight-based, and first dose given in the ED. Supportive care discussed with parent, including acetaminophen or ibuprofen for pain or fever, and maintaining hydration. If symptoms fail to improve or worsen despite treatment, advised prompt re-evaluation.<br><br>If non-bacterial / watchful waiting:<br><br> Findings reviewed with parent at bedside. Presentation may represent early or serous otitis rather than acute bacterial infection; advised supportive care with acetaminophen or ibuprofen as needed and close follow-up if symptoms persist or worsen.<br><br>Patient remained comfortable and interactive throughout the ED visit with stable vital signs and reassuring physical findings. Findings and plan reviewed with parent at bedside, who verbalized understanding and was comfortable with discharge and outpatient follow-up.<br><br>Strict return precautions discussed, including persistent fever, worsening ear pain, drainage from the ear, vomiting, lethargy, poor oral intake, new rash, neck stiffness, or any new or concerning symptoms. Follow-up with pediatrician advised within 48‚Äì72 hours or sooner if symptoms worsen.</div>

        </div><div class="bg-panel rounded-2xl shadow-card" draggable="true" data-id="peds-pna">

          <div class="macro-card rounded-2xl p-3.5 flex items-start justify-between gap-3">

            <div>

              <h3 class="text-[1rem] font-semibold text-white mb-1">Pediatric Pneumonia ‚Äî MDM Template</h3>

              <button data-action="copy-dot" data-id="peds-pna" class="inline-flex items-center gap-1 bg-white/10 hover:bg-white/20 text-[11px] text-white rounded-full px-2.5 py-0.5">Dot: .pedspna</button>

            </div>

            <div class="flex gap-2 shrink-0">

              <button data-action="copy" data-id="peds-pna" class="text-xs bg-white/10 hover:bg-white/20 text-white rounded-md px-2.5 py-1">Copy</button>

              <button data-action="edit" data-id="peds-pna" class="text-xs bg-white/10 hover:bg-white/20 text-white rounded-md px-2.5 py-1">Edit</button>

              <button data-action="del" data-id="peds-pna" class="text-xs bg-white/10 hover:bg-white/20 text-white rounded-md px-2.5 py-1">Del</button>

            </div>

          </div>

          <div class="macro-body rounded-b-2xl p-3.5 text-[0.9rem] leading-6">Patient presented with [cough / fever / shortness of breath / malaise] for [duration] prior to arrival. Parent present at bedside reports [persistent cough / decreased appetite / mild fatigue / increased work of breathing] with [no vomiting / no lethargy / no rash]. On exam, patient was alert, interactive, and behaving appropriately for age. Lungs revealed [focal crackles / diminished breath sounds / rhonchi / mild wheezing], with [no retractions / no nasal flaring / normal oxygen saturation]. Findings otherwise reassuring, with no signs of respiratory distress or dehydration.<br><br>Differential includes viral pneumonia, bacterial pneumonia, bronchiolitis, asthma or reactive airway exacerbation, and upper respiratory infection. Findings today are most consistent with [bacterial / viral] pneumonia based on clinical picture and [chest x-ray results / auscultatory findings].<br><br>Findings and imaging were consistent with [bacterial / viral] pneumonia. Patient was [prescribed / given] [amoxicillin / azithromycin / cefdinir], weight-based, for outpatient treatment. Supportive care discussed with parent at bedside, including acetaminophen or ibuprofen for fever control and encouraging fluids as tolerated. [Continued with prescribed albuterol as needed.] Parent verbalized understanding and was comfortable with the plan for discharge and follow-up.<br><br>Return precautions discussed, including but not limited to: worsening or persistent fever, increased work of breathing, chest pain, vomiting, lethargy, poor oral intake, cyanosis, or any new or concerning symptoms. Advised follow-up with pediatrician within 48‚Äì72 hours for reassessment or sooner if symptoms worsen.</div>

        </div><div class="bg-panel rounded-2xl shadow-card" draggable="true" data-id="comm-out">

          <div class="macro-card rounded-2xl p-3.5 flex items-start justify-between gap-3">

            <div>

              <h3 class="text-[1rem] font-semibold text-white mb-1">Communication sign out</h3>

              <button data-action="copy-dot" data-id="comm-out" class="inline-flex items-center gap-1 bg-white/10 hover:bg-white/20 text-[11px] text-white rounded-full px-2.5 py-0.5">Dot: .signout</button>

            </div>

            <div class="flex gap-2 shrink-0">

              <button data-action="copy" data-id="comm-out" class="text-xs bg-white/10 hover:bg-white/20 text-white rounded-md px-2.5 py-1">Copy</button>

              <button data-action="edit" data-id="comm-out" class="text-xs bg-white/10 hover:bg-white/20 text-white rounded-md px-2.5 py-1">Edit</button>

              <button data-action="del" data-id="comm-out" class="text-xs bg-white/10 hover:bg-white/20 text-white rounded-md px-2.5 py-1">Del</button>

            </div>

          </div>

          <div class="macro-body rounded-b-2xl p-3.5 text-[0.9rem] leading-6">Patient signed out to [Dr. _____] at [time] with pending [labs / imaging / re-evaluation]. Clinical course and current status reviewed in detail. Disposition options discussed and plan of care conveyed to the receiving provider, who will follow pending results and determine final disposition. Patient remained stable at time of sign-out.</div>

        </div><div class="bg-panel rounded-2xl shadow-card" draggable="true" data-id="comm-in">

          <div class="macro-card rounded-2xl p-3.5 flex items-start justify-between gap-3">

            <div>

              <h3 class="text-[1rem] font-semibold text-white mb-1">Communication signin</h3>

              <button data-action="copy-dot" data-id="comm-in" class="inline-flex items-center gap-1 bg-white/10 hover:bg-white/20 text-[11px] text-white rounded-full px-2.5 py-0.5">Dot: .signin</button>

            </div>

            <div class="flex gap-2 shrink-0">

              <button data-action="copy" data-id="comm-in" class="text-xs bg-white/10 hover:bg-white/20 text-white rounded-md px-2.5 py-1">Copy</button>

              <button data-action="edit" data-id="comm-in" class="text-xs bg-white/10 hover:bg-white/20 text-white rounded-md px-2.5 py-1">Edit</button>

              <button data-action="del" data-id="comm-in" class="text-xs bg-white/10 hover:bg-white/20 text-white rounded-md px-2.5 py-1">Del</button>

            </div>

          </div>

          <div class="macro-body rounded-b-2xl p-3.5 text-[0.9rem] leading-6">Patient received in sign-out from [Dr. _____] at [time] with pending [results / re-evaluation / consults]. Prior ED course, findings, and disposition considerations reviewed. Assuming ongoing care and final disposition.</div>

        </div><div class="bg-panel rounded-2xl shadow-card" draggable="true" data-id="peds-head-nct">

          <div class="macro-card rounded-2xl p-3.5 flex items-start justify-between gap-3">

            <div>

              <h3 class="text-[1rem] font-semibold text-white mb-1">MDM ‚Äî Pediatric Head Trauma (No CT, No Observation)</h3>

              <button data-action="copy-dot" data-id="peds-head-nct" class="inline-flex items-center gap-1 bg-white/10 hover:bg-white/20 text-[11px] text-white rounded-full px-2.5 py-0.5">Dot: .pedshead-nct</button>

            </div>

            <div class="flex gap-2 shrink-0">

              <button data-action="copy" data-id="peds-head-nct" class="text-xs bg-white/10 hover:bg-white/20 text-white rounded-md px-2.5 py-1">Copy</button>

              <button data-action="edit" data-id="peds-head-nct" class="text-xs bg-white/10 hover:bg-white/20 text-white rounded-md px-2.5 py-1">Edit</button>

              <button data-action="del" data-id="peds-head-nct" class="text-xs bg-white/10 hover:bg-white/20 text-white rounded-md px-2.5 py-1">Del</button>

            </div>

          </div>

          <div class="macro-body rounded-b-2xl p-3.5 text-[0.9rem] leading-6">PECARN CALCULATIONS:<br><br>Age group: [&lt;2 years / ‚â•2 years]<br><br>Mechanism of injury: [describe]<br><br>PECARN ciTBI estimated risk:<br><br>    &lt;2 years: &lt;0.02 %<br><br>    ‚â•2 years: &lt;0.05 %<br><br>All predictors negative:<br><br>    - Normal mental status, GCS 15<br><br>    - No loss of consciousness (‚â•2 y: any; &lt;2 y: ‚â•5 s)<br><br>    - No palpable or basilar skull fracture<br><br>    - No non-frontal scalp hematoma (&lt;2 y)<br><br>    - No vomiting, severe headache, or severe mechanism<br><br>---<br><br>Patient presented after minor head trauma with no loss of consciousness, vomiting, or abnormal behavior. On examination, child appeared well, alert, and interactive for age with normal tone, strength, and coordination. Pupils equal and reactive; no scalp hematoma or tenderness; no step-off or signs of basilar skull fracture. Vitals stable and age-appropriate. No focal neurologic deficits.<br><br>Based on the PECARN decision rule, patient meets very-low-risk criteria for clinically important traumatic brain injury (estimated risk &lt;0.05%). Given the absence of concerning features and a reassuring neurologic exam, no head CT or prolonged observation is indicated. Discussed the extremely low probability of intracranial injury and risks associated with radiation exposure with the parent, who agreed with home observation. All questions answered and expectations reviewed.<br><br>Patient remained well-appearing and interactive during ED course. Discharged home with strict return precautions for persistent vomiting, worsening headache, confusion, seizure, focal deficits, lethargy, or poor oral intake. Advised follow-up with pediatrician within 48 hours or sooner if concerns arise.</div>

        </div><div class="bg-panel rounded-2xl shadow-card" draggable="true" data-id="peds-head-observe">

          <div class="macro-card rounded-2xl p-3.5 flex items-start justify-between gap-3">

            <div>

              <h3 class="text-[1rem] font-semibold text-white mb-1">MDM ‚Äî Pediatric Head Trauma (Observation without CT)</h3>

              <button data-action="copy-dot" data-id="peds-head-observe" class="inline-flex items-center gap-1 bg-white/10 hover:bg-white/20 text-[11px] text-white rounded-full px-2.5 py-0.5">Dot: .pedshead-observe</button>

            </div>

            <div class="flex gap-2 shrink-0">

              <button data-action="copy" data-id="peds-head-observe" class="text-xs bg-white/10 hover:bg-white/20 text-white rounded-md px-2.5 py-1">Copy</button>

              <button data-action="edit" data-id="peds-head-observe" class="text-xs bg-white/10 hover:bg-white/20 text-white rounded-md px-2.5 py-1">Edit</button>

              <button data-action="del" data-id="peds-head-observe" class="text-xs bg-white/10 hover:bg-white/20 text-white rounded-md px-2.5 py-1">Del</button>

            </div>

          </div>

          <div class="macro-body rounded-b-2xl p-3.5 text-[0.9rem] leading-6">PECARN CALCULATIONS:<br><br>Age group: [&lt;2 years / ‚â•2 years]  <br><br>Mechanism of injury: [describe]  <br><br>PECARN ciTBI estimated risk:  <br><br>‚ÄÉ&lt; 2 years ‚âà 0.9 %‚ÄÉ‚ÄÉ‚â• 2 years ‚âà 0.8 %  <br><br>Low-risk group with intermediate factor(s): [list specific factor(s)]  <br><br>‚ÄÉ- Normal mental status / GCS 15  <br><br>‚ÄÉ- No palpable or basilar skull fracture  <br><br>‚ÄÉ- No signs of focal neurologic deficit  <br><br>‚ÄÉ- May have isolated vomiting / brief LOC / mild headache / frontal hematoma  <br><br>‚ÄÉ- Mechanism not severe  <br><br>---<br><br>Patient presented after minor head trauma with [brief loss of consciousness / single vomit / mild headache] and otherwise normal behavior per caregiver. Exam revealed a well-appearing, interactive child with normal pupils, tone, strength, and coordination. No skull tenderness or step-off appreciated; tympanic membranes clear; no basilar signs. Vitals stable and appropriate for age.<br><br>Using the PECARN rule, patient falls within the low-risk ‚Äúobservation‚Äù zone (&lt; 1 % risk for ciTBI). Given the absence of high-risk findings and reassuring exam, CT was deferred in favor of ED observation with serial neurologic assessments. Family counseled regarding small residual risk of intracranial injury versus radiation exposure from CT, and agreed with observation.<br><br>Patient observed in the ED for [__ hours] with stable vitals, normal serial neuro exams, and no further vomiting or changes in behavior. Findings remained reassuring. Discussed warning signs and need for prompt return if headache, vomiting, confusion, seizure, lethargy, or any new neurologic deficits develop. Discharged home in stable condition with follow-up arranged with pediatrician within 24‚Äì48 hours.</div>

        </div><div class="bg-panel rounded-2xl shadow-card" draggable="true" data-id="peds-head-ct">

          <div class="macro-card rounded-2xl p-3.5 flex items-start justify-between gap-3">

            <div>

              <h3 class="text-[1rem] font-semibold text-white mb-1">MDM ‚Äî Pediatric Head Trauma (CT Recommended)</h3>

              <button data-action="copy-dot" data-id="peds-head-ct" class="inline-flex items-center gap-1 bg-white/10 hover:bg-white/20 text-[11px] text-white rounded-full px-2.5 py-0.5">Dot: .pedshead-ct</button>

            </div>

            <div class="flex gap-2 shrink-0">

              <button data-action="copy" data-id="peds-head-ct" class="text-xs bg-white/10 hover:bg-white/20 text-white rounded-md px-2.5 py-1">Copy</button>

              <button data-action="edit" data-id="peds-head-ct" class="text-xs bg-white/10 hover:bg-white/20 text-white rounded-md px-2.5 py-1">Edit</button>

              <button data-action="del" data-id="peds-head-ct" class="text-xs bg-white/10 hover:bg-white/20 text-white rounded-md px-2.5 py-1">Del</button>

            </div>

          </div>

          <div class="macro-body rounded-b-2xl p-3.5 text-[0.9rem] leading-6">PECARN CALCULATIONS:<br><br>Age group: [&lt;2 years / ‚â•2 years]  <br><br>Mechanism of injury: [describe]  <br><br>PECARN ciTBI estimated risk:  <br><br>‚ÄÉ&lt; 2 years ‚âà 4.4 %‚ÄÉ‚ÄÉ‚â• 2 years ‚âà 4.3 %  <br><br>High-risk feature(s) present: [list specific findings]  <br><br>‚ÄÉ- Abnormal mental status or GCS &lt; 15 at 2 hours  <br><br>‚ÄÉ- Palpable skull fracture (&lt; 2 y) / Signs of basilar skull fracture (‚â• 2 y)  <br><br>‚ÄÉ- Severe mechanism (fall &gt; 3 ft &lt; 2 y / &gt; 5 ft ‚â• 2 y; pedestrian / bicyclist struck; high-impact object)  <br><br>‚ÄÉ- Repeated vomiting / severe headache  <br><br>‚ÄÉ- Any focal neuro deficit or seizure  <br><br>---<br><br>Patient presented after [mechanism] with [concerning symptom: vomiting, altered mental status, skull defect, or severe headache]. On arrival, GCS [15 / less if applicable]; pupils equal and reactive; no significant external bleeding. Exam revealed [palpable frontal step-off / battle sign / periorbital ecchymosis / hematoma description]. Neurologic exam otherwise intact. Vitals stable.<br><br>By PECARN criteria, presence of [high-risk finding] places patient in the imaging pathway with ‚âà4 % risk for ciTBI. Discussed the evidence-based recommendation for head CT to exclude intracranial injury and reviewed the benefits and radiation risks with the parent. Consent obtained for imaging after shared decision-making.<br><br>Patient remained hemodynamically stable and interactive while awaiting CT. Imaging [negative / demonstrated ___]. If negative, findings consistent with minor head injury without intracranial pathology; family counseled on home observation and return precautions. If positive, neurosurgery and pediatrics consulted for management and admission as indicated. All results and follow-up instructions reviewed with caregiver who verbalized understanding.</div>

        </div><div class="bg-panel rounded-2xl shadow-card" draggable="true" data-id="hyperbili-below">

          <div class="macro-card rounded-2xl p-3.5 flex items-start justify-between gap-3">

            <div>

              <h3 class="text-[1rem] font-semibold text-white mb-1">MDM ‚Äî Neonatal Hyperbilirubinemia (Below Phototherapy Threshold)</h3>

              <button data-action="copy-dot" data-id="hyperbili-below" class="inline-flex items-center gap-1 bg-white/10 hover:bg-white/20 text-[11px] text-white rounded-full px-2.5 py-0.5">Dot: .hyperbili-below</button>

            </div>

            <div class="flex gap-2 shrink-0">

              <button data-action="copy" data-id="hyperbili-below" class="text-xs bg-white/10 hover:bg-white/20 text-white rounded-md px-2.5 py-1">Copy</button>

              <button data-action="edit" data-id="hyperbili-below" class="text-xs bg-white/10 hover:bg-white/20 text-white rounded-md px-2.5 py-1">Edit</button>

              <button data-action="del" data-id="hyperbili-below" class="text-xs bg-white/10 hover:bg-white/20 text-white rounded-md px-2.5 py-1">Del</button>

            </div>

          </div>

          <div class="macro-body rounded-b-2xl p-3.5 text-[0.9rem] leading-6">BILIRUBIN CALCULATIONS / RISK FACTORS:<br><br>Age at sampling: [__ hours]‚ÄÉGestational age: [__ weeks + __ days]‚ÄÉBirth weight: [__ g]  <br><br>Feeding / weight loss: [breast / formula ; __ % loss]  <br><br>AAP 2022 Risk Factors: [none / GA &lt; 38 w / isoimmune hemolysis / G6PD / sepsis / albumin &lt; 3.0 / bruising or cephalohematoma]  <br><br>Measurements: TSB [__ mg/dL] at [__ h]‚ÄÉPhototherapy threshold [__ mg/dL]‚ÄÉŒî to threshold = [__ mg/dL] (below)  <br><br>Exchange threshold [__ mg/dL]‚ÄÉRisk curve / percentile [__]<br><br>---<br><br>Infant evaluated for neonatal jaundice at [__ hours] of life. Well appearing, alert, and feeding [adequately / improving] with stable vitals and no evidence of lethargy, poor tone, or dehydration. No scleral icterus beyond mild facial/chest jaundice. TSB of [__ mg/dL] is below the AAP phototherapy threshold of [__ mg/dL] for gestational age and risk profile, placing infant in the low-risk zone for clinically significant hyperbilirubinemia.<br><br>Findings consistent with physiologic jaundice. Discussed expected bilirubin course and importance of frequent feeds to optimize enteric clearance. Family educated on return precautions for poor feeding, lethargy, dark urine, acholic stools, or worsening jaundice to the lower extremities. Plan for repeat bilirubin check within 24‚Äì48 hours and close pediatric follow-up. Caregivers verbalized understanding and comfort with home observation.</div>

        </div><div class="bg-panel rounded-2xl shadow-card" draggable="true" data-id="hyperbili-photo">

          <div class="macro-card rounded-2xl p-3.5 flex items-start justify-between gap-3">

            <div>

              <h3 class="text-[1rem] font-semibold text-white mb-1">MDM ‚Äî Neonatal Hyperbilirubinemia (Phototherapy Initiated)</h3>

              <button data-action="copy-dot" data-id="hyperbili-photo" class="inline-flex items-center gap-1 bg-white/10 hover:bg-white/20 text-[11px] text-white rounded-full px-2.5 py-0.5">Dot: .hyperbili-photo</button>

            </div>

            <div class="flex gap-2 shrink-0">

              <button data-action="copy" data-id="hyperbili-photo" class="text-xs bg-white/10 hover:bg-white/20 text-white rounded-md px-2.5 py-1">Copy</button>

              <button data-action="edit" data-id="hyperbili-photo" class="text-xs bg-white/10 hover:bg-white/20 text-white rounded-md px-2.5 py-1">Edit</button>

              <button data-action="del" data-id="hyperbili-photo" class="text-xs bg-white/10 hover:bg-white/20 text-white rounded-md px-2.5 py-1">Del</button>

            </div>

          </div>

          <div class="macro-body rounded-b-2xl p-3.5 text-[0.9rem] leading-6">BILIRUBIN CALCULATIONS / RISK FACTORS:<br><br>Age at sampling: [__ hours]‚ÄÉGestational age: [__ weeks + __ days]‚ÄÉBirth weight: [__ g]  <br><br>AAP 2022 Risk Factors: [GA &lt; 38 w / isoimmune hemolysis / G6PD / sepsis / albumin &lt; 3.0 / other]  <br><br>Measurements: TSB [__ mg/dL] at [__ h]‚ÄÉPhototherapy threshold [__ mg/dL]‚ÄÉŒî to threshold = [__ mg/dL] (at/above)  <br><br>Exchange threshold [__ mg/dL]‚ÄÉRate of rise (if known) [__ mg/dL/hr]<br><br>---<br><br>Infant presented with progressive jaundice; on exam alert and interactive with normal tone and suck. No signs of acute bilirubin encephalopathy. Serum bilirubin above AAP phototherapy threshold for age and risk factors. No dehydration or clinical signs of infection.<br><br>Initiated intensive phototherapy using LED blue lights with maximized body surface exposure and eye protection in place. Encouraged frequent feeds to enhance bilirubin elimination and monitored intake/output. No signs of hemolysis or cephalohematoma requiring additional intervention. Family counseled on treatment course, expected timeline for decline in TSB, and need for serial levels to confirm response.<br><br>Patient tolerated therapy well with stable vitals and improving jaundice trend. Plan for TSB recheck in 4‚Äì6 hours to confirm decrease, continue phototherapy until TSB is &gt; 2 mg/dL below threshold and trending down. If criteria met, phototherapy to be stopped with rebound TSB draw 6‚Äì12 hours later as indicated. Parents informed of follow-up requirements and return precautions.</div>

        </div><div class="bg-panel rounded-2xl shadow-card" draggable="true" data-id="hyperbili-exchange">

          <div class="macro-card rounded-2xl p-3.5 flex items-start justify-between gap-3">

            <div>

              <h3 class="text-[1rem] font-semibold text-white mb-1">MDM ‚Äî Neonatal Hyperbilirubinemia (Escalation / Exchange Threshold)</h3>

              <button data-action="copy-dot" data-id="hyperbili-exchange" class="inline-flex items-center gap-1 bg-white/10 hover:bg-white/20 text-[11px] text-white rounded-full px-2.5 py-0.5">Dot: .hyperbili-exchange</button>

            </div>

            <div class="flex gap-2 shrink-0">

              <button data-action="copy" data-id="hyperbili-exchange" class="text-xs bg-white/10 hover:bg-white/20 text-white rounded-md px-2.5 py-1">Copy</button>

              <button data-action="edit" data-id="hyperbili-exchange" class="text-xs bg-white/10 hover:bg-white/20 text-white rounded-md px-2.5 py-1">Edit</button>

              <button data-action="del" data-id="hyperbili-exchange" class="text-xs bg-white/10 hover:bg-white/20 text-white rounded-md px-2.5 py-1">Del</button>

            </div>

          </div>

          <div class="macro-body rounded-b-2xl p-3.5 text-[0.9rem] leading-6">BILIRUBIN CALCULATIONS / RISK FACTORS:<br><br>Age at sampling: [__ hours]‚ÄÉGestational age: [__ weeks + __ days]‚ÄÉBirth weight: [__ g]  <br><br>Risk Factors: [isoimmune hemolysis / G6PD / sepsis / albumin &lt; 3.0 / GA &lt; 38 w / other]  <br><br>Measurements: TSB [__ mg/dL] at [__ h]‚ÄÉPhototherapy threshold [__ mg/dL]‚ÄÉExchange threshold [__ mg/dL]  <br><br>Œî to exchange = [__ mg/dL] (‚â• 0 = at/above)‚ÄÉRate of rise [__ mg/dL/hr]<br><br>---<br><br>Infant with known hyperbilirubinemia on intensive phototherapy demonstrating TSB at or above the AAP exchange threshold. Examination shows alertness with slightly diminished tone but no overt signs of acute bilirubin encephalopathy. Vitals stable, feeding adequate. IV access established and volume status addressed.<br><br>Given TSB [__ mg/dL] at [__ hours] of life and Œî to exchange of [__ mg/dL], consulted Neonatology / NICU for escalation of care and potential exchange transfusion. Additional labs obtained including blood type, DAT/Coombs, CBC/retic, bilirubin fractionation, albumin, and G6PD level. If isoimmune hemolysis present, considered IVIG per AAP protocol. Supportive care continued with maximal phototherapy and temperature monitoring.<br><br>Discussed clinical status and risk of bilirubin neurotoxicity with caregivers; family understood need for NICU-level management and possible exchange procedure. Patient remained hemodynamically stable during transfer preparations.</div>

        </div></div>

    </main>

  </div>

  <!-- TOAST -->

  <div id="toast" class="fixed bottom-4 left-1/2 -translate-x-1/2 bg-ink text-white px-4 py-2 rounded-full text-sm shadow-card transition opacity-100 opacity-0 pointer-events-none">Macro copied.</div>

  <!-- EMBEDDED SOURCE OF TRUTH -->

  <script id="initial-data" type="application/json">{
  "settings": {
    "owner": "raquelvsuarezucf-dot",
    "repo": "ED-templates-RS",
    "branch": "main",
    "path": "index.html",
    "token_obf": "NTB5cU8ydEx5VWYyaklRUDNtd000WVc3enY0YlRkNmc1d0J0X3BoZw==",
    "netlify": ""
  },
  "categories": [
    "All",
    "Pediatrics",
    "Communication",
    "Neonatal / Hyperbili",
    "Peds ‚Äî Trauma / PECARN"
  ],
  "macros": [
    {
      "id": "peds-viral",
      "title": "MDM ‚Äî Pediatric Viral / Febrile Illness",
      "category": "Pediatrics",
      "dot": ".pedsviral",
      "body": "[age]-year-old [sex] presented to the ED with [duration] of fever and associated [symptoms: cough, nasal congestion, rhinorrhea, decreased appetite, irritability]. Parent present at bedside reports patient has been tolerating PO without difficulties, with [no / mild] decrease in appetite and normal urine output. Denies vomiting, diarrhea, rash, or respiratory distress. Immunizations are up to date.\n\nOn evaluation, patient appeared well hydrated, interactive, and appropriate for age, with normal capillary refill and no increased work of breathing. Oropharynx clear, tympanic membranes without bulging or erythema, lungs clear to auscultation, and abdomen soft, non-tender, and non-distended.\n\nDifferential includes viral upper respiratory infection, early otitis media, influenza, RSV, COVID-19, and early pneumonia, though there were no focal findings to strongly suggest a bacterial source. Findings today are most consistent with a viral process. [COVID, influenza, and RSV tests were negative / pending / positive for ___ / not obtained.]\n\nPatient remained comfortable and interactive throughout the ED visit with stable vital signs and reassuring physical findings. Findings reviewed with the parent at bedside, and supportive care discussed, including weight-based acetaminophen or ibuprofen for fever and encouraging fluids as tolerated. Parent verbalized understanding and was comfortable with the plan for discharge and outpatient follow-up.\n\nStrict return precautions discussed, including persistent fever, respiratory distress, poor oral intake, vomiting, decreased urine output, new rash, or any new or concerning symptoms. Follow-up with pediatrician advised within 48‚Äì72 hours or sooner if symptoms worsen."
    },
    {
      "id": "peds-strep",
      "title": "Pediatric Streptococcal Pharyngitis (cleaned up + consistent with your tone)",
      "category": "Pediatrics",
      "dot": ".pedsstrep",
      "body": "[age]-year-old [sex] presented to the ED with [duration] of sore throat associated with [symptoms: fever, decreased appetite, odynophagia, mild cough / no cough, nasal congestion]. Parent present at bedside reports patient has been tolerating PO intake [well / poorly] and maintaining normal urine output. Denies vomiting, drooling, neck stiffness, or respiratory distress. Immunizations are up to date.\n\nOn exam, patient appeared well hydrated, interactive, and nontoxic. Oropharyngeal exam notable for [tonsillar erythema / exudates / palatal petechiae / none], uvula midline, and no evidence of peritonsillar swelling or trismus. Cervical nodes [tender / non-tender, enlarged / not enlarged]. Lungs clear to auscultation and no meningeal signs or rash observed.\n\nDifferential includes streptococcal pharyngitis, viral pharyngitis, early tonsillitis, and mononucleosis, with low concern for peritonsillar abscess, epiglottitis, or retropharyngeal infection given the reassuring airway exam and overall well appearance. Findings today are most consistent with [streptococcal / viral] pharyngitis. [Rapid strep test positive / negative / pending; throat culture sent / not obtained.] [COVID, influenza, and RSV tests negative / positive for ___ / not obtained.]\n\nFor confirmed or suspected streptococcal infection, prescribed [amoxicillin / cephalexin / azithromycin] ‚Äî weight-based dosing ‚Äî with instructions to complete the full course. Supportive care discussed, including acetaminophen or ibuprofen for fever or throat pain, maintaining hydration, and soft foods as tolerated.\n\nPatient remained comfortable and interactive throughout the ED visit with stable vital signs and reassuring physical findings. Findings reviewed with the parent at bedside, who verbalized understanding and was comfortable with the plan for discharge and outpatient follow-up.\n\nStrict return precautions discussed, including persistent fever, worsening throat pain, drooling, difficulty swallowing or breathing, neck swelling, or any new or concerning symptoms. Follow-up with pediatrician advised within 48‚Äì72 hours or sooner if symptoms worsen."
    },
    {
      "id": "peds-otitis",
      "title": "MDM ‚Äî Pediatric Otitis Media",
      "category": "Pediatrics",
      "dot": ".pedsotitis",
      "body": "[age]-year-old [sex] presented to the ED with [duration] of ear pain associated with [symptoms: fever, nasal congestion, cough, irritability, decreased appetite]. Parent present at bedside reports patient has been tolerating PO intake [well / poorly] with normal urinary output. Denies vomiting, drainage from the ear, rash, or respiratory distress. Immunizations are up to date.\n\nOn exam, patient appeared well hydrated and interactive for age. Right / left tympanic membrane noted to be [erythematous / bulging / dull / effusion present / normal]; no mastoid tenderness, auricular swelling, or drainage. Contralateral ear within normal limits. Lungs clear to auscultation, and oropharynx without erythema or exudate. Neck supple with full range of motion and no lymphadenopathy. Abdomen soft and non-tender.\n\nDifferential includes acute otitis media, otitis externa, eustachian tube dysfunction, and viral upper respiratory infection. Findings today are most consistent with [acute otitis media / serous otitis / viral URI with referred ear pain]. [COVID, influenza, and RSV tests negative / positive for ___ / not obtained.]\n\nIf bacterial:\n\n Antibiotic therapy initiated with [amoxicillin / cefdinir / azithromycin], weight-based, and first dose given in the ED. Supportive care discussed with parent, including acetaminophen or ibuprofen for pain or fever, and maintaining hydration. If symptoms fail to improve or worsen despite treatment, advised prompt re-evaluation.\n\nIf non-bacterial / watchful waiting:\n\n Findings reviewed with parent at bedside. Presentation may represent early or serous otitis rather than acute bacterial infection; advised supportive care with acetaminophen or ibuprofen as needed and close follow-up if symptoms persist or worsen.\n\nPatient remained comfortable and interactive throughout the ED visit with stable vital signs and reassuring physical findings. Findings and plan reviewed with parent at bedside, who verbalized understanding and was comfortable with discharge and outpatient follow-up.\n\nStrict return precautions discussed, including persistent fever, worsening ear pain, drainage from the ear, vomiting, lethargy, poor oral intake, new rash, neck stiffness, or any new or concerning symptoms. Follow-up with pediatrician advised within 48‚Äì72 hours or sooner if symptoms worsen."
    },
    {
      "id": "peds-pna",
      "title": "Pediatric Pneumonia ‚Äî MDM Template",
      "category": "Pediatrics",
      "dot": ".pedspna",
      "body": "Patient presented with [cough / fever / shortness of breath / malaise] for [duration] prior to arrival. Parent present at bedside reports [persistent cough / decreased appetite / mild fatigue / increased work of breathing] with [no vomiting / no lethargy / no rash]. On exam, patient was alert, interactive, and behaving appropriately for age. Lungs revealed [focal crackles / diminished breath sounds / rhonchi / mild wheezing], with [no retractions / no nasal flaring / normal oxygen saturation]. Findings otherwise reassuring, with no signs of respiratory distress or dehydration.\n\nDifferential includes viral pneumonia, bacterial pneumonia, bronchiolitis, asthma or reactive airway exacerbation, and upper respiratory infection. Findings today are most consistent with [bacterial / viral] pneumonia based on clinical picture and [chest x-ray results / auscultatory findings].\n\nFindings and imaging were consistent with [bacterial / viral] pneumonia. Patient was [prescribed / given] [amoxicillin / azithromycin / cefdinir], weight-based, for outpatient treatment. Supportive care discussed with parent at bedside, including acetaminophen or ibuprofen for fever control and encouraging fluids as tolerated. [Continued with prescribed albuterol as needed.] Parent verbalized understanding and was comfortable with the plan for discharge and follow-up.\n\nReturn precautions discussed, including but not limited to: worsening or persistent fever, increased work of breathing, chest pain, vomiting, lethargy, poor oral intake, cyanosis, or any new or concerning symptoms. Advised follow-up with pediatrician within 48‚Äì72 hours for reassessment or sooner if symptoms worsen."
    },
    {
      "id": "comm-out",
      "title": "Communication sign out",
      "category": "Communication",
      "dot": ".signout",
      "body": "Patient signed out to [Dr. _____] at [time] with pending [labs / imaging / re-evaluation]. Clinical course and current status reviewed in detail. Disposition options discussed and plan of care conveyed to the receiving provider, who will follow pending results and determine final disposition. Patient remained stable at time of sign-out."
    },
    {
      "id": "comm-in",
      "title": "Communication signin",
      "category": "Communication",
      "dot": ".signin",
      "body": "Patient received in sign-out from [Dr. _____] at [time] with pending [results / re-evaluation / consults]. Prior ED course, findings, and disposition considerations reviewed. Assuming ongoing care and final disposition."
    },
    {
      "id": "peds-head-nct",
      "title": "MDM ‚Äî Pediatric Head Trauma (No CT, No Observation)",
      "category": "Peds ‚Äî Trauma / PECARN",
      "dot": ".pedshead-nct",
      "body": "PECARN CALCULATIONS:\n\nAge group: [<2 years / ‚â•2 years]\n\nMechanism of injury: [describe]\n\nPECARN ciTBI estimated risk:\n\n    <2 years: <0.02 %\n\n    ‚â•2 years: <0.05 %\n\nAll predictors negative:\n\n    - Normal mental status, GCS 15\n\n    - No loss of consciousness (‚â•2 y: any; <2 y: ‚â•5 s)\n\n    - No palpable or basilar skull fracture\n\n    - No non-frontal scalp hematoma (<2 y)\n\n    - No vomiting, severe headache, or severe mechanism\n\n---\n\nPatient presented after minor head trauma with no loss of consciousness, vomiting, or abnormal behavior. On examination, child appeared well, alert, and interactive for age with normal tone, strength, and coordination. Pupils equal and reactive; no scalp hematoma or tenderness; no step-off or signs of basilar skull fracture. Vitals stable and age-appropriate. No focal neurologic deficits.\n\nBased on the PECARN decision rule, patient meets very-low-risk criteria for clinically important traumatic brain injury (estimated risk <0.05%). Given the absence of concerning features and a reassuring neurologic exam, no head CT or prolonged observation is indicated. Discussed the extremely low probability of intracranial injury and risks associated with radiation exposure with the parent, who agreed with home observation. All questions answered and expectations reviewed.\n\nPatient remained well-appearing and interactive during ED course. Discharged home with strict return precautions for persistent vomiting, worsening headache, confusion, seizure, focal deficits, lethargy, or poor oral intake. Advised follow-up with pediatrician within 48 hours or sooner if concerns arise."
    },
    {
      "id": "peds-head-observe",
      "title": "MDM ‚Äî Pediatric Head Trauma (Observation without CT)",
      "category": "Peds ‚Äî Trauma / PECARN",
      "dot": ".pedshead-observe",
      "body": "PECARN CALCULATIONS:\n\nAge group: [<2 years / ‚â•2 years]  \n\nMechanism of injury: [describe]  \n\nPECARN ciTBI estimated risk:  \n\n‚ÄÉ< 2 years ‚âà 0.9 %‚ÄÉ‚ÄÉ‚â• 2 years ‚âà 0.8 %  \n\nLow-risk group with intermediate factor(s): [list specific factor(s)]  \n\n‚ÄÉ- Normal mental status / GCS 15  \n\n‚ÄÉ- No palpable or basilar skull fracture  \n\n‚ÄÉ- No signs of focal neurologic deficit  \n\n‚ÄÉ- May have isolated vomiting / brief LOC / mild headache / frontal hematoma  \n\n‚ÄÉ- Mechanism not severe  \n\n---\n\nPatient presented after minor head trauma with [brief loss of consciousness / single vomit / mild headache] and otherwise normal behavior per caregiver. Exam revealed a well-appearing, interactive child with normal pupils, tone, strength, and coordination. No skull tenderness or step-off appreciated; tympanic membranes clear; no basilar signs. Vitals stable and appropriate for age.\n\nUsing the PECARN rule, patient falls within the low-risk ‚Äúobservation‚Äù zone (< 1 % risk for ciTBI). Given the absence of high-risk findings and reassuring exam, CT was deferred in favor of ED observation with serial neurologic assessments. Family counseled regarding small residual risk of intracranial injury versus radiation exposure from CT, and agreed with observation.\n\nPatient observed in the ED for [__ hours] with stable vitals, normal serial neuro exams, and no further vomiting or changes in behavior. Findings remained reassuring. Discussed warning signs and need for prompt return if headache, vomiting, confusion, seizure, lethargy, or any new neurologic deficits develop. Discharged home in stable condition with follow-up arranged with pediatrician within 24‚Äì48 hours."
    },
    {
      "id": "peds-head-ct",
      "title": "MDM ‚Äî Pediatric Head Trauma (CT Recommended)",
      "category": "Peds ‚Äî Trauma / PECARN",
      "dot": ".pedshead-ct",
      "body": "PECARN CALCULATIONS:\n\nAge group: [<2 years / ‚â•2 years]  \n\nMechanism of injury: [describe]  \n\nPECARN ciTBI estimated risk:  \n\n‚ÄÉ< 2 years ‚âà 4.4 %‚ÄÉ‚ÄÉ‚â• 2 years ‚âà 4.3 %  \n\nHigh-risk feature(s) present: [list specific findings]  \n\n‚ÄÉ- Abnormal mental status or GCS < 15 at 2 hours  \n\n‚ÄÉ- Palpable skull fracture (< 2 y) / Signs of basilar skull fracture (‚â• 2 y)  \n\n‚ÄÉ- Severe mechanism (fall > 3 ft < 2 y / > 5 ft ‚â• 2 y; pedestrian / bicyclist struck; high-impact object)  \n\n‚ÄÉ- Repeated vomiting / severe headache  \n\n‚ÄÉ- Any focal neuro deficit or seizure  \n\n---\n\nPatient presented after [mechanism] with [concerning symptom: vomiting, altered mental status, skull defect, or severe headache]. On arrival, GCS [15 / less if applicable]; pupils equal and reactive; no significant external bleeding. Exam revealed [palpable frontal step-off / battle sign / periorbital ecchymosis / hematoma description]. Neurologic exam otherwise intact. Vitals stable.\n\nBy PECARN criteria, presence of [high-risk finding] places patient in the imaging pathway with ‚âà4 % risk for ciTBI. Discussed the evidence-based recommendation for head CT to exclude intracranial injury and reviewed the benefits and radiation risks with the parent. Consent obtained for imaging after shared decision-making.\n\nPatient remained hemodynamically stable and interactive while awaiting CT. Imaging [negative / demonstrated ___]. If negative, findings consistent with minor head injury without intracranial pathology; family counseled on home observation and return precautions. If positive, neurosurgery and pediatrics consulted for management and admission as indicated. All results and follow-up instructions reviewed with caregiver who verbalized understanding."
    },
    {
      "id": "hyperbili-below",
      "title": "MDM ‚Äî Neonatal Hyperbilirubinemia (Below Phototherapy Threshold)",
      "category": "Neonatal / Hyperbili",
      "dot": ".hyperbili-below",
      "body": "BILIRUBIN CALCULATIONS / RISK FACTORS:\n\nAge at sampling: [__ hours]‚ÄÉGestational age: [__ weeks + __ days]‚ÄÉBirth weight: [__ g]  \n\nFeeding / weight loss: [breast / formula ; __ % loss]  \n\nAAP 2022 Risk Factors: [none / GA < 38 w / isoimmune hemolysis / G6PD / sepsis / albumin < 3.0 / bruising or cephalohematoma]  \n\nMeasurements: TSB [__ mg/dL] at [__ h]‚ÄÉPhototherapy threshold [__ mg/dL]‚ÄÉŒî to threshold = [__ mg/dL] (below)  \n\nExchange threshold [__ mg/dL]‚ÄÉRisk curve / percentile [__]\n\n---\n\nInfant evaluated for neonatal jaundice at [__ hours] of life. Well appearing, alert, and feeding [adequately / improving] with stable vitals and no evidence of lethargy, poor tone, or dehydration. No scleral icterus beyond mild facial/chest jaundice. TSB of [__ mg/dL] is below the AAP phototherapy threshold of [__ mg/dL] for gestational age and risk profile, placing infant in the low-risk zone for clinically significant hyperbilirubinemia.\n\nFindings consistent with physiologic jaundice. Discussed expected bilirubin course and importance of frequent feeds to optimize enteric clearance. Family educated on return precautions for poor feeding, lethargy, dark urine, acholic stools, or worsening jaundice to the lower extremities. Plan for repeat bilirubin check within 24‚Äì48 hours and close pediatric follow-up. Caregivers verbalized understanding and comfort with home observation."
    },
    {
      "id": "hyperbili-photo",
      "title": "MDM ‚Äî Neonatal Hyperbilirubinemia (Phototherapy Initiated)",
      "category": "Neonatal / Hyperbili",
      "dot": ".hyperbili-photo",
      "body": "BILIRUBIN CALCULATIONS / RISK FACTORS:\n\nAge at sampling: [__ hours]‚ÄÉGestational age: [__ weeks + __ days]‚ÄÉBirth weight: [__ g]  \n\nAAP 2022 Risk Factors: [GA < 38 w / isoimmune hemolysis / G6PD / sepsis / albumin < 3.0 / other]  \n\nMeasurements: TSB [__ mg/dL] at [__ h]‚ÄÉPhototherapy threshold [__ mg/dL]‚ÄÉŒî to threshold = [__ mg/dL] (at/above)  \n\nExchange threshold [__ mg/dL]‚ÄÉRate of rise (if known) [__ mg/dL/hr]\n\n---\n\nInfant presented with progressive jaundice; on exam alert and interactive with normal tone and suck. No signs of acute bilirubin encephalopathy. Serum bilirubin above AAP phototherapy threshold for age and risk factors. No dehydration or clinical signs of infection.\n\nInitiated intensive phototherapy using LED blue lights with maximized body surface exposure and eye protection in place. Encouraged frequent feeds to enhance bilirubin elimination and monitored intake/output. No signs of hemolysis or cephalohematoma requiring additional intervention. Family counseled on treatment course, expected timeline for decline in TSB, and need for serial levels to confirm response.\n\nPatient tolerated therapy well with stable vitals and improving jaundice trend. Plan for TSB recheck in 4‚Äì6 hours to confirm decrease, continue phototherapy until TSB is > 2 mg/dL below threshold and trending down. If criteria met, phototherapy to be stopped with rebound TSB draw 6‚Äì12 hours later as indicated. Parents informed of follow-up requirements and return precautions."
    },
    {
      "id": "hyperbili-exchange",
      "title": "MDM ‚Äî Neonatal Hyperbilirubinemia (Escalation / Exchange Threshold)",
      "category": "Neonatal / Hyperbili",
      "dot": ".hyperbili-exchange",
      "body": "BILIRUBIN CALCULATIONS / RISK FACTORS:\n\nAge at sampling: [__ hours]‚ÄÉGestational age: [__ weeks + __ days]‚ÄÉBirth weight: [__ g]  \n\nRisk Factors: [isoimmune hemolysis / G6PD / sepsis / albumin < 3.0 / GA < 38 w / other]  \n\nMeasurements: TSB [__ mg/dL] at [__ h]‚ÄÉPhototherapy threshold [__ mg/dL]‚ÄÉExchange threshold [__ mg/dL]  \n\nŒî to exchange = [__ mg/dL] (‚â• 0 = at/above)‚ÄÉRate of rise [__ mg/dL/hr]\n\n---\n\nInfant with known hyperbilirubinemia on intensive phototherapy demonstrating TSB at or above the AAP exchange threshold. Examination shows alertness with slightly diminished tone but no overt signs of acute bilirubin encephalopathy. Vitals stable, feeding adequate. IV access established and volume status addressed.\n\nGiven TSB [__ mg/dL] at [__ hours] of life and Œî to exchange of [__ mg/dL], consulted Neonatology / NICU for escalation of care and potential exchange transfusion. Additional labs obtained including blood type, DAT/Coombs, CBC/retic, bilirubin fractionation, albumin, and G6PD level. If isoimmune hemolysis present, considered IVIG per AAP protocol. Supportive care continued with maximal phototherapy and temperature monitoring.\n\nDiscussed clinical status and risk of bilirubin neurotoxicity with caregivers; family understood need for NICU-level management and possible exchange procedure. Patient remained hemodynamically stable during transfer preparations."
    }
  ]
}</script>

  <script>

    const MACRO_STORAGE_KEY = 'emtemplates.macros.v1';

    const SETTINGS_KEY = 'emtemplates.settings.v1';

    const CATEGORY_KEY = 'emtemplates.categories.v1';

    const AUTH_KEY = 'emtemplates.authed';

    const AUTO_SYNC = true; // <‚Äî autosync enabled

    let MACROS = [];

    let CATEGORIES = [];

    let SETTINGS = {};

    function obfToken(plain) {

      if (!plain) return '';

      const rev = plain.split('').reverse().join('');

      return btoa(rev);

    }

    function deobfToken(obf) {

      if (!obf) return '';

      try {

        const rev = atob(obf);

        return rev.split('').reverse().join('');

      } catch (e) {

        return '';

      }

    }

    (function bootstrap() {

      const el = document.getElementById('initial-data');

      let embedded = null;

      if (el && el.textContent.trim()) {

        try { embedded = JSON.parse(el.textContent); } catch (e) { embedded = null; }

      }

      try {

        const lsMacros = JSON.parse(localStorage.getItem(MACRO_STORAGE_KEY) || 'null');

        const lsCats   = JSON.parse(localStorage.getItem(CATEGORY_KEY) || 'null');

        const lsSet    = JSON.parse(localStorage.getItem(SETTINGS_KEY) || 'null');

        MACROS = lsMacros || (embedded && embedded.macros) || [];

        CATEGORIES = lsCats || (embedded && embedded.categories) || ['All'];

        const embeddedSettings = (embedded && embedded.settings) || {};

        if (lsSet) {

          SETTINGS = lsSet;

        } else {

          SETTINGS = {

            owner: embeddedSettings.owner || '',

            repo: embeddedSettings.repo || '',

            branch: embeddedSettings.branch || 'main',

            path: embeddedSettings.path || 'index.html',

            token: deobfToken(embeddedSettings.token_obf || ''),

            netlify: embeddedSettings.netlify || ''

          };

        }

      } catch (e) {

        MACROS = (embedded && embedded.macros) || [];

        CATEGORIES = (embedded && embedded.categories) || ['All'];

        const embeddedSettings = (embedded && embedded.settings) || {};

        SETTINGS = {

          owner: embeddedSettings.owner || '',

          repo: embeddedSettings.repo || '',

          branch: embeddedSettings.branch || 'main',

          path: embeddedSettings.path || 'index.html',

          token: deobfToken(embeddedSettings.token_obf || ''),

          netlify: embeddedSettings.netlify || ''

        };

      }

      if (!CATEGORIES.includes('All')) CATEGORIES.unshift('All');

    })();

    const macroList = document.getElementById('macro-list');

    const searchInput = document.getElementById('search');

    const sectionTitle = document.getElementById('section-title').querySelector('h2');

    const sectionCount = document.getElementById('section-count');

    const catList = document.getElementById('cat-list');

    const toast = document.getElementById('toast');

    const editModal = document.getElementById('edit-modal');

    const editHeading = document.getElementById('edit-heading');

    const editTitle = document.getElementById('edit-title');

    const editDot = document.getElementById('edit-dot');

    const editBody = document.getElementById('edit-body');

    let editingId = null;

    const newModal = document.getElementById('new-macro-modal');

    const newTitle = document.getElementById('new-title');

    const newDot = document.getElementById('new-dot');

    const newCatSelect = document.getElementById('new-cat');

    const newBody = document.getElementById('new-body');

    const loginOverlay = document.getElementById('login-overlay');

    const loginUser = document.getElementById('login-user');

    const loginPass = document.getElementById('login-pass');

    const loginSubmit = document.getElementById('login-submit');

    const loginError = document.getElementById('login-error');

    let activeCat = 'All';

    function showToast(msg) {

      toast.textContent = msg;

      toast.classList.remove('opacity-0','pointer-events-none');

      toast.classList.add('opacity-100');

      setTimeout(() => {

        toast.classList.add('opacity-0','pointer-events-none');

      }, 1600);

    }

    function renderCategories() {

      catList.innerHTML = '';

      CATEGORIES.forEach(cat => {

        const btn = document.createElement('button');

        btn.type = 'button';

        btn.dataset.cat = cat;

        btn.className = 'cat-btn w-full flex items-center justify-between bg-white/70 hover:bg-white rounded-2xl px-4 py-3 text-[0.9rem] text-ink';

        if (cat === activeCat) btn.classList.add('bg-white');

        const count = cat === 'All' ? MACROS.length : MACROS.filter(m => m.category === cat).length;

        btn.innerHTML = `<span>${cat}</span><span class="text-xs text-slate-500">${count}</span>`;

        btn.addEventListener('dragover', (e) => {

          e.preventDefault();

          btn.classList.add('drag-target');

        });

        btn.addEventListener('dragleave', () => btn.classList.remove('drag-target'));

        btn.addEventListener('drop', (e) => {

          e.preventDefault();

          const id = e.dataTransfer.getData('text/plain');

          const idx = MACROS.findIndex(m => m.id === id);

          if (idx !== -1) {

            MACROS[idx].category = cat === 'All' ? MACROS[idx].category : cat;

            localStorage.setItem(MACRO_STORAGE_KEY, JSON.stringify(MACROS));

            renderCategories();

            renderMacros();

            autoSync();

          }

          btn.classList.remove('drag-target');

        });

        btn.addEventListener('click', () => {

          activeCat = cat;

          sectionTitle.textContent = cat === 'All' ? 'All macros' : cat;

          renderCategories();

          renderMacros();

        });

        catList.appendChild(btn);

      });

    }

    function renderMacros() {

      const q = (searchInput.value || '').toLowerCase();

      const filtered = MACROS.filter(m => {

        const inCat = activeCat === 'All' ? true : m.category === activeCat;

        if (!inCat) return false;

        if (!q) return true;

        const txt = (m.title + ' ' + m.body + ' ' + m.dot).toLowerCase();

        return txt.includes(q);

      });

      macroList.innerHTML = '';

      filtered.forEach(m => {

        const div = document.createElement('div');

        div.className = 'bg-panel rounded-2xl shadow-card';

        div.draggable = true;

        div.dataset.id = m.id;

        div.addEventListener('dragstart', (e) => {

          e.dataTransfer.setData('text/plain', m.id);

        });

        div.innerHTML = `

          <div class="macro-card rounded-2xl p-3.5 flex items-start justify-between gap-3">

            <div>

              <h3 class="text-[1rem] font-semibold text-white mb-1">${m.title}</h3>

              <button data-action="copy-dot" data-id="${m.id}" class="inline-flex items-center gap-1 bg-white/10 hover:bg-white/20 text-[11px] text-white rounded-full px-2.5 py-0.5">Dot: ${m.dot}</button>

            </div>

            <div class="flex gap-2 shrink-0">

              <button data-action="copy" data-id="${m.id}" class="text-xs bg-white/10 hover:bg-white/20 text-white rounded-md px-2.5 py-1">Copy</button>

              <button data-action="edit" data-id="${m.id}" class="text-xs bg-white/10 hover:bg-white/20 text-white rounded-md px-2.5 py-1">Edit</button>

              <button data-action="del" data-id="${m.id}" class="text-xs bg-white/10 hover:bg-white/20 text-white rounded-md px-2.5 py-1">Del</button>

            </div>

          </div>

          <div class="macro-body rounded-b-2xl p-3.5 text-[0.9rem] leading-6">${m.body.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\n/g,'<br>')}</div>

        `;

        macroList.appendChild(div);

      });

      sectionCount.textContent = filtered.length + ' macros';

      renderCategories();

    }

    // debounce

    let syncTimer = null;

    function autoSync() {

      if (!AUTO_SYNC) return;

      if (syncTimer) clearTimeout(syncTimer);

      syncTimer = setTimeout(() => {

        githubSync(true); // silent

      }, 1500);

    }

    macroList.addEventListener('click', (e) => {

      const btn = e.target.closest('button[data-action]');

      if (!btn) return;

      const action = btn.dataset.action;

      const id = btn.dataset.id;

      const macro = MACROS.find(m => m.id === id);

      if (!macro) return;

      if (action === 'copy') {

        navigator.clipboard.writeText(macro.body).then(() => showToast('Macro copied.'));

      } else if (action === 'copy-dot') {

        navigator.clipboard.writeText(macro.dot).then(() => showToast('Dot phrase copied.'));

      } else if (action === 'edit') {

        editingId = macro.id;

        editHeading.textContent = 'Edit ‚Äî ' + macro.title;

        editTitle.value = macro.title;

        editDot.value = macro.dot;

        editBody.value = macro.body;

        editModal.classList.add('open');

      } else if (action === 'del') {

        if (confirm('Delete this macro?')) {

          const idx = MACROS.findIndex(m => m.id === id);

          if (idx !== -1) {

            MACROS.splice(idx, 1);

            localStorage.setItem(MACRO_STORAGE_KEY, JSON.stringify(MACROS));

            renderMacros();

            showToast('Macro deleted.');

            autoSync();

          }

        }

      }

    });

    document.getElementById('edit-close').addEventListener('click', () => editModal.classList.remove('open'));

    document.getElementById('edit-cancel').addEventListener('click', () => editModal.classList.remove('open'));

    editModal.addEventListener('click', (e) => { if (e.target === editModal) editModal.classList.remove('open'); });

    document.getElementById('edit-save').addEventListener('click', () => {

      if (!editingId) return;

      const idx = MACROS.findIndex(m => m.id === editingId);

      if (idx !== -1) {

        MACROS[idx].title = editTitle.value.trim() || MACROS[idx].title;

        MACROS[idx].dot = editDot.value.trim() || MACROS[idx].dot;

        MACROS[idx].body = editBody.value;

        localStorage.setItem(MACRO_STORAGE_KEY, JSON.stringify(MACROS));

        renderMacros();

        showToast('Macro updated.');

        autoSync();

      }

      editModal.classList.remove('open');

    });

    searchInput.addEventListener('input', renderMacros);

    searchInput.addEventListener('keydown', (e) => {

      if (e.key === 'Enter') {

        const val = searchInput.value.trim();

        if (val.startsWith('.')) {

          const found = MACROS.find(m => m.dot.toLowerCase() === val.toLowerCase());

          if (found) {

            navigator.clipboard.writeText(found.body).then(() => showToast(`Copied ${found.dot}`));

            e.preventDefault();

          }

        }

      }

    });

    const settingsBtn = document.getElementById('settings-btn');

    const settingsPop = document.getElementById('settings-pop');

    const settingsClose = document.getElementById('settings-close');

    settingsBtn.addEventListener('click', () => settingsPop.classList.toggle('open'));

    settingsClose.addEventListener('click', () => settingsPop.classList.remove('open'));

    document.addEventListener('click', (e) => {

      if (!settingsPop.contains(e.target) && e.target !== settingsBtn) {

        settingsPop.classList.remove('open');

      }

    });

    (function populateSettingsForm() {

      document.getElementById('gh-owner').value = SETTINGS.owner || 'raquelvsuarezucf-dot';

      document.getElementById('gh-repo').value = SETTINGS.repo || 'ED-templates-RS';

      document.getElementById('gh-branch').value = SETTINGS.branch || 'main';

      document.getElementById('gh-path').value = SETTINGS.path || 'index.html';

      document.getElementById('gh-token').value = SETTINGS.token || '';

      document.getElementById('netlify-hook').value = SETTINGS.netlify || '';

    })();

    document.getElementById('settings-save').addEventListener('click', () => {

      SETTINGS = {

        owner: document.getElementById('gh-owner').value,

        repo: document.getElementById('gh-repo').value,

        branch: document.getElementById('gh-branch').value,

        path: document.getElementById('gh-path').value,

        token: document.getElementById('gh-token').value,

        netlify: document.getElementById('netlify-hook').value

      };

      localStorage.setItem(SETTINGS_KEY, JSON.stringify(SETTINGS));

      showToast('Settings saved.');

      autoSync();

    });

    document.getElementById('save-site').addEventListener('click', () => {

      localStorage.setItem(MACRO_STORAGE_KEY, JSON.stringify(MACROS));

      localStorage.setItem(CATEGORY_KEY, JSON.stringify(CATEGORIES));

      showToast('Site saved.');

      autoSync();

    });

    document.getElementById('add-category').addEventListener('click', () => {

      const name = prompt('New category name?');

      if (!name) return;

      if (CATEGORIES.includes(name)) {

        showToast('Category already exists.');

        return;

      }

      CATEGORIES.push(name);

      localStorage.setItem(CATEGORY_KEY, JSON.stringify(CATEGORIES));

      renderCategories();

      populateNewMacroSelect();

      autoSync();

    });

    document.getElementById('new-macro-btn').addEventListener('click', () => {

      populateNewMacroSelect();

      newTitle.value = '';

      newDot.value = '';

      newBody.value = '';

      newModal.classList.add('open');

    });

    document.getElementById('new-macro-close').addEventListener('click', () => newModal.classList.remove('open'));

    document.getElementById('new-macro-cancel').addEventListener('click', () => newModal.classList.remove('open'));

    newModal.addEventListener('click', (e) => { if (e.target === newModal) newModal.classList.remove('open'); });

    function populateNewMacroSelect() {

      newCatSelect.innerHTML = '';

      CATEGORIES.filter(c => c !== 'All').forEach(cat => {

        const opt = document.createElement('option');

        opt.value = cat;

        opt.textContent = cat;

        newCatSelect.appendChild(opt);

      });

    }

    document.getElementById('new-macro-save').addEventListener('click', () => {

      const title = newTitle.value.trim();

      const dot = newDot.value.trim() || '.newmacro';

      const cat = newCatSelect.value;

      const body = newBody.value.trim() || '[new macro body]';

      if (!title) {

        alert('Title required');

        return;

      }

      const id = 'macro-' + Math.random().toString(36).slice(2, 8);

      MACROS.push({ id, title, category: cat, dot, body });

      localStorage.setItem(MACRO_STORAGE_KEY, JSON.stringify(MACROS));

      newModal.classList.remove('open');

      renderMacros();

      showToast('Macro added.');

      autoSync();

    });

    // LOGIN

    function showLoginIfNeeded() {

      const authed = localStorage.getItem(AUTH_KEY);

      if (authed === 'true') {

        loginOverlay.classList.remove('open');

      } else {

        loginOverlay.classList.add('open');

        loginUser.value = '';

        loginPass.value = '';

        loginError.classList.add('hidden');

      }

    }

    showLoginIfNeeded();

    function attemptLogin() {

      const u = loginUser.value.trim();

      const p = loginPass.value;

      if (u === 'emtemplates' && p === 'odynophagia') {

        localStorage.setItem(AUTH_KEY, 'true');

        loginOverlay.classList.remove('open');

      } else {

        loginError.classList.remove('hidden');

      }

    }

    loginSubmit.addEventListener('click', attemptLogin);

    loginPass.addEventListener('keydown', (e) => {

      if (e.key === 'Enter') attemptLogin();

    });

    // build HTML with current data baked in ‚Äî INCLUDING OBFUSCATED TOKEN

    function buildExportHTML() {

      const doc = document.documentElement.cloneNode(true);

      const script = doc.querySelector('#initial-data');

      const exported = {

        settings: {

          owner: document.getElementById('gh-owner').value.trim(),

          repo: document.getElementById('gh-repo').value.trim(),

          branch: document.getElementById('gh-branch').value.trim() || 'main',

          path: document.getElementById('gh-path').value.trim() || 'index.html',

          token_obf: obfToken(document.getElementById('gh-token').value.trim()),

          netlify: document.getElementById('netlify-hook').value.trim()

        },

        categories: CATEGORIES,

        macros: MACROS

      };

      if (script) {

        script.textContent = JSON.stringify(exported, null, 2);

      }

      return '<!DOCTYPE html>\n' + doc.outerHTML;

    }

    async function githubSync(silent = false) {

      const owner = document.getElementById('gh-owner').value.trim();

      const repo = document.getElementById('gh-repo').value.trim();

      const branch = document.getElementById('gh-branch').value.trim() || 'main';

      const path = document.getElementById('gh-path').value.trim() || 'index.html';

      const token = document.getElementById('gh-token').value.trim();

      const netlify = document.getElementById('netlify-hook').value.trim();

      if (!owner || !repo || !token) {

        if (!silent) showToast('Owner, repo, token required.');

        return;

      }

      const html = buildExportHTML();

      const apiBase = `https://api.github.com/repos/${encodeURIComponent(owner)}/${encodeURIComponent(repo)}/contents/${encodeURIComponent(path)}`;

      let sha = null;

      try {

        const res = await fetch(apiBase + `?ref=${encodeURIComponent(branch)}`, {

          headers: {

            'Authorization': `Bearer ${token}`,

            'Accept': 'application/vnd.github+json'

          }

        });

        if (res.ok) {

          const json = await res.json();

          sha = json.sha;

        }

      } catch (err) {

        if (!silent) showToast('GitHub: GET failed.');

      }

      const content = btoa(unescape(encodeURIComponent(html)));

      const body = {

        message: 'Update EM templates page',

        content,

        branch

      };

      if (sha) body.sha = sha;

      try {

        const putRes = await fetch(apiBase, {

          method: 'PUT',

          headers: {

            'Authorization': `Bearer ${token}`,

            'Accept': 'application/vnd.github+json',

            'Content-Type': 'application/json'

          },

          body: JSON.stringify(body)

        });

        if (!putRes.ok) {

          if (!silent) {

            let msg = `GitHub sync failed (${putRes.status})`;

            try {

              const errJson = await putRes.json();

              if (errJson && errJson.message) msg = `GitHub: ${errJson.message}`;

            } catch (_) {}

            showToast(msg);

          }

          return;

        }

      } catch (err) {

        if (!silent) showToast('GitHub sync failed (network).');

        return;

      }

      if (!silent) showToast('GitHub sync OK.');

      if (netlify) {

        try {

          await fetch(netlify, { method: 'POST' });

          if (!silent) showToast('Netlify build triggered.');

        } catch (err) {

          if (!silent) showToast('Netlify hook failed.');

        }

      }

    }

    document.getElementById('settings-sync').addEventListener('click', () => githubSync(false));

    // init

    renderCategories();

    renderMacros();

  </script>



</body></html>